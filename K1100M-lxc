# Remember that host and guest driver have to be in sync!

# https://theorangeone.net/posts/lxc-nvidia-gpu-passthrough/

# K1100M specific
wget https://us.download.nvidia.com/XFree86/Linux-x86_64/470.161.03/NVIDIA-Linux-x86_64-470.161.03.run

# Disable nouveau driver, just copying exactly what the Nvidia installer would make
cat << EOF >> /etc/modprobe.d/nvidia-installer-disable-nouveau.conf
# generated by nvidia-installer
blacklist nouveau
options nouveau modeset=0
EOF

reboot now

sh NVIDIA-Linux-x86_64-470.161.03.run --no-kernel-module # Use default options

cat << EOF >> /some/path/to/lxc/container/config # CHANGE THIS FILE PATH
# Allow cgroup access
lxc.cgroup.devices.allow: c 195:* rwm
lxc.cgroup.devices.allow: c 234:* rwm

# Pass through device files
lxc.mount.entry: /dev/nvidia0 dev/nvidia0 none bind,optional,create=file
lxc.mount.entry: /dev/nvidiactl dev/nvidiactl none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm dev/nvidia-uvm none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-modeset dev/nvidia-modeset none bind,optional,create=file
lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-uvm-tools none bind,optional,create=file
